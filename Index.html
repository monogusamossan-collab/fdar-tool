<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FDARコピペッター（軽量版）</title>
  <style>
    :root{color-scheme:light dark;}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif;margin:0;padding:16px;line-height:1.45}
    h1{font-size:18px;margin:0 0 10px}
    .card{border:1px solid rgba(127,127,127,.35);border-radius:12px;padding:12px;margin:10px 0}
    label{display:block;font-size:12px;opacity:.85;margin:10px 0 4px}
    input,textarea,select{width:100%;box-sizing:border-box;border:1px solid rgba(127,127,127,.35);border-radius:10px;padding:10px;font-size:14px;background:transparent}
    textarea{min-height:88px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row>*{flex:1 1 160px}
    button{border:0;border-radius:12px;padding:10px 12px;font-size:14px;background:#111;color:#fff}
    button.secondary{background:transparent;color:inherit;border:1px solid rgba(127,127,127,.35)}
    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tiny{font-size:12px;opacity:.8}
    pre{white-space:pre-wrap;border:1px dashed rgba(127,127,127,.45);border-radius:12px;padding:10px;margin:10px 0}
  </style>
</head>
<body>
  <h1>FDARコピペッター（軽量版）</h1>

  <div class="card">
    <div class="row">
      <div>
        <label>イニシャル</label>
        <input id="pt" placeholder="例：KS" />
      </div>
      <div>
        <label>テンプレ</label>
        <select id="tpl">
          <option value="nochange">お変わり無し（前回踏襲）</option>
          <option value="resp">呼吸（HOT/息切れ）</option>
          <option value="strength">筋力低下（廃用）</option>
          <option value="gait">歩行・動作（ふらつき）</option>
        </select>
      </div>
    </div>

    <label>メモ（音声入力した内容をそのまま）</label>
    <textarea id="memo" placeholder="例：動作時の息切れが増悪。HOT自己判断で外しがち。口腔内血痰は改善傾向。"></textarea>

    <div class="btns">
      <button id="gen">FDAR生成</button>
      <button class="secondary" id="copy">コピー</button>
      <button class="secondary" id="clear">クリア</button>
    </div>
    <div class="tiny">※端末内のみで動作（サーバー送信なし）</div>
  </div>

  <div class="card">
    <label>出力（そのままiBowに貼り付け）</label>
    <pre id="out"></pre>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);

  function nowJP(){
    const d=new Date();
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,'0');
    const day=String(d.getDate()).padStart(2,'0');
    return `${y}/${m}/${day}`;
  }

  function baseFDAR(pt, focus, memo){
    const date = nowJP();
    return `【${date} ${pt}】\nF：${focus}\nD：${memo || "前回同様。大きな変化なし。"}\nA：筋力増強訓練、関節可動域訓練、基本動作訓練、日常生活動作訓練、歩行訓練\nR：理解あり。実施継続。`;
  }

  function template(pt, key, memo){
    if(key==="nochange"){
      return `【${nowJP()} ${pt}】\nF：前回内容踏襲\nD：本日特記事項なし。状態お変わり無し。\nA：前回同様に実施（筋力増強訓練、関節可動域訓練、基本動作訓練、日常生活動作訓練、歩行訓練）\nR：同意あり。`;
    }
    if(key==="resp"){
      return baseFDAR(pt,"呼吸機能低下", memo || "動作時の息切れが増悪傾向。HOT自己判断で未使用となる場面あり。使用状況を確認し注意喚起。");
    }
    if(key==="strength"){
      return baseFDAR(pt,"四肢体幹の筋力低下", memo || "呼吸苦等により臥床時間が長く、活動量低下。食事前後は座位で過ごす。");
    }
    if(key==="gait"){
      return baseFDAR(pt,"歩行・動作能力低下", memo || "立位・歩行でふらつきあり。屋内移動時の見守り・環境調整を提案。");
    }
    return baseFDAR(pt,"", memo);
  }

  $("gen").addEventListener("click", ()=>{
    const pt = ($("pt").value || "").trim() || "PT";
    const key = $("tpl").value;
    const memo = ($("memo").value || "").trim();
    $("out").textContent = template(pt, key, memo);
  });

  $("copy").addEventListener("click", async ()=>{
    const text = $("out").textContent.trim();
    if(!text){ alert("先にFDAR生成してください"); return; }
    try{
      await navigator.clipboard.writeText(text);
      alert("コピーしました");
    }catch(e){
      // fallback
      const ta=document.createElement("textarea");
      ta.value=text; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy");
      document.body.removeChild(ta);
      alert("コピーしました");
    }
  });

  $("clear").addEventListener("click", ()=>{
    $("memo").value="";
    $("out").textContent="";
  });
</script>
</body>
</html>
