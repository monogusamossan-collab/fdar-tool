<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SOAP è‡ªå‹•è¨˜éŒ²ãƒ¡ãƒ¼ã‚«ãƒ¼</title>

  <style>
    :root { color-scheme: light dark; }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif;
      margin:0; padding:18px;
      max-width:860px; line-height:1.45;
    }
    h1{ font-size:22px; margin:0 0 8px; }
    .subTitle{ margin:0 0 14px; opacity:.85; font-size:13px; }

    .card{
      border:1px solid rgba(127,127,127,.35);
      border-radius:16px;
      padding:14px;
      background: rgba(127,127,127,.06);
    }

    label{ display:block; font-size:12px; opacity:.9; margin:10px 0 6px; }
    input, textarea{
      width:100%;
      max-width:100%;
      box-sizing:border-box;
      border:1px solid rgba(127,127,127,.35);
      border-radius:12px;
      padding:12px;
      background: rgba(127,127,127,.08);
      color:inherit;
      font-size:16px;
      outline:none;
    }
    textarea{ min-height:84px; resize:vertical; }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .row > div{ min-width:0; }
    input{ min-width:0; }

    @media (max-width:520px){
      .row{ grid-template-columns:1fr; }
    }

    .btnRow{
      display:flex; flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
    }
    button{
      border:1px solid rgba(127,127,127,.35);
      background: rgba(127,127,127,.08);
      color:inherit;
      border-radius:14px;
      padding:12px 14px;
      font-size:14px;
    }
    button.primary{
      background: rgba(60,120,255,.18);
      border-color: rgba(60,120,255,.45);
    }

    .out{ margin-top:14px; }
    pre{
      white-space:pre-wrap;
      word-break:break-word;
      border:1px solid rgba(127,127,127,.35);
      background: rgba(127,127,127,.06);
      border-radius:14px;
      padding:12px;
      min-height:80px;
    }

    .badge{
      position:fixed;
      right:14px;
      bottom:86px;
      z-index:10;
      font-size:12px;
      opacity:.9;
      border:1px solid rgba(127,127,127,.35);
      background: rgba(0,0,0,.55);
      color:#fff;
      padding:8px 10px;
      border-radius:999px;
    }
    .micBtn{
      position:fixed;
      right:14px;
      bottom:18px;
      z-index:10;
      border:1px solid rgba(127,127,127,.35);
      background: rgba(0,0,0,.8);
      color:#fff;
      border-radius:999px;
      padding:14px 16px;
      font-size:15px;
    }
    a.back{
      display:inline-block;
      margin-top:10px;
      font-size:13px;
      opacity:.9;
      color:inherit;
      text-decoration:none;
    }
    /* å…¥åŠ›æ¬„ã¯ã¿å‡ºã—é˜²æ­¢ */
input,
textarea {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  font-size: 16px;
}

/* dateå°‚ç”¨ï¼ˆiPhoneå¯¾ç­–ï¼‰ */
input[type="date"] {
  width: 100%;
  max-width: 100%;
  -webkit-appearance: none;
}
  </style>
</head>

<body>
  <h1>SOAP è‡ªå‹•è¨˜éŒ²ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
  <p class="subTitle">å…¥åŠ›ã—ã¦ã€Œã‚³ãƒ¼ãƒ‰åŒ–â†’ã‚³ãƒ”ãƒ¼ã€ã€‚</p>

  <div class="card">
    <div class="row">
      <div>
        <label>åˆ©ç”¨è€…ï¼ˆã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ï¼‰</label>
        <input id="client" placeholder="ä¾‹ï¼šAæ§˜ / KM ãªã©ï¼ˆå€‹äººãŒç‰¹å®šã§ãã‚‹æƒ…å ±ã¯å…¥åŠ›ã—ãªã„ï¼‰" />
      </div>
      <div>
        <label>æ—¥ä»˜</label>
        <input id="date" type="date" />
      </div>
    </div>

    <label>Sï¼ˆä¸»è¦³ï¼‰</label>
    <textarea id="s" placeholder="ä¾‹ï¼šæœ¬äººè¨´ãˆã€ç—›ã¿ã€ä½“èª¿ã€å¸Œæœ›ãªã©"></textarea>

    <label>Oï¼ˆå®¢è¦³ï¼‰</label>
    <textarea id="o" placeholder="ä¾‹ï¼šãƒã‚¤ã‚¿ãƒ«ã€æ‰€è¦‹ã€å‹•ä½œã€è¦³å¯Ÿãªã©"></textarea>

    <label>Aï¼ˆè©•ä¾¡ï¼‰</label>
    <textarea id="a" placeholder="ä¾‹ï¼šè§£é‡ˆã€å•é¡Œç‚¹ã€è¦å› ã€ãƒªã‚¹ã‚¯ãªã©"></textarea>

    <label>Pï¼ˆè¨ˆç”»ï¼‰</label>
    <textarea id="p" placeholder="ä¾‹ï¼šå®Ÿæ–½å†…å®¹ã€æ¬¡å›æ–¹é‡ã€æŒ‡å°ãªã©"></textarea>

    <div class="btnRow">
      <button class="primary" id="render">ã‚³ãƒ¼ãƒ‰åŒ–ã—ã¦ã‚³ãƒ”ãƒ¼</button>
      <button id="clear">å…¨æ¶ˆå»</button>
      <button id="save">ã“ã®å†…å®¹ã‚’ä¿å­˜</button>
      <button id="load">ä¿å­˜ã‚’èª­ã¿è¾¼ã¿</button>
    </div>

    <div class="out">
      <label>å‡ºåŠ›ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</label>
      <pre id="preview"></pre>
    </div>

    <a class="back" href="../../">â† ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
  </div>

  <div class="badge" id="status">å¾…æ©Ÿä¸­</div>
  <button class="micBtn" id="mic">ğŸ™ éŸ³å£°é–‹å§‹</button>

<script>
  (function initDate(){
    const el = document.getElementById('date');
    if (!el.value) {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      el.value = `${yyyy}-${mm}-${dd}`;
    }
  })();

  const $ = (id)=>document.getElementById(id);

  function buildText(){
    const client = $('client').value.trim();
    const date = $('date').value ? $('date').value.replaceAll('-','/') : '';
    const s = $('s').value.trim();
    const o = $('o').value.trim();
    const a = $('a').value.trim();
    const p = $('p').value.trim();

    const head = `${date}${client ? " / " + client : ""}`.trim();
    return [
      head ? `ã€${head}ã€‘` : '',
      s ? `Sï¼š${s}` : 'Sï¼š',
      o ? `Oï¼š${o}` : 'Oï¼š',
      a ? `Aï¼š${a}` : 'Aï¼š',
      p ? `Pï¼š${p}` : 'Pï¼š'
    ].filter(Boolean).join('\n');
  }

  function render(){
    $('preview').textContent = buildText();
  }

  async function copyToClipboard(text){
    try{
      await navigator.clipboard.writeText(text);
      $('status').textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
      setTimeout(()=> $('status').textContent = 'å¾…æ©Ÿä¸­', 1200);
    }catch(e){
      $('status').textContent = 'ã‚³ãƒ”ãƒ¼å¤±æ•—ï¼ˆé•·æŠ¼ã—ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼‰';
    }
  }

  $('render').addEventListener('click', ()=>{
    render();
    copyToClipboard($('preview').textContent);
  });

  $('clear').addEventListener('click', ()=>{
    ['client','s','o','a','p'].forEach(id=>$(id).value='');
    render();
  });

  $('save').addEventListener('click', ()=>{
    const payload = {
      client:$('client').value, date:$('date').value,
      s:$('s').value, o:$('o').value, a:$('a').value, p:$('p').value
    };
    localStorage.setItem('soap_save', JSON.stringify(payload));
    $('status').textContent = 'ä¿å­˜ã—ã¾ã—ãŸ';
    setTimeout(()=> $('status').textContent = 'å¾…æ©Ÿä¸­', 1200);
  });

  $('load').addEventListener('click', ()=>{
    const raw = localStorage.getItem('soap_save');
    if(!raw){ $('status').textContent = 'ä¿å­˜ãŒã‚ã‚Šã¾ã›ã‚“'; return; }
    const p = JSON.parse(raw);
    $('client').value = p.client || '';
    $('date').value = p.date || $('date').value;
    $('s').value = p.s || '';
    $('o').value = p.o || '';
    $('a').value = p.a || '';
    $('p').value = p.p || '';
    render();
    $('status').textContent = 'èª­ã¿è¾¼ã¿ã¾ã—ãŸ';
    setTimeout(()=> $('status').textContent = 'å¾…æ©Ÿä¸­', 1200);
  });

  // éŸ³å£°ï¼ˆç°¡æ˜“ï¼šSã«è¿½è¨˜ï¼‰
  let rec = null;
  let listening = false;
  $('mic').addEventListener('click', ()=>{
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR){
      $('status').textContent = 'ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›éå¯¾å¿œ';
      return;
    }
    if(!rec){
      rec = new SR();
      rec.lang = 'ja-JP';
      rec.interimResults = true;
      rec.continuous = true;

      rec.onresult = (e)=>{
        let text = '';
        for(let i=e.resultIndex;i<e.results.length;i++){
          text += e.results[i][0].transcript;
        }
        $('s').value = ($('s').value + ( $('s').value ? '\n' : '' ) + text).trim();
        render();
      };
      rec.onend = ()=>{
        if(listening){ try{ rec.start(); }catch(_){} }
      };
    }

    if(!listening){
      listening = true;
      $('status').textContent = 'éŸ³å£°å…¥åŠ›ä¸­';
      $('mic').textContent = 'ğŸ›‘ éŸ³å£°åœæ­¢';
      try{ rec.start(); }catch(_){}
    }else{
      listening = false;
      $('status').textContent = 'å¾…æ©Ÿä¸­';
      $('mic').textContent = 'ğŸ™ éŸ³å£°é–‹å§‹';
      try{ rec.stop(); }catch(_){}
    }
  });

  render();
</script>
</body>
</html>
