<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FDARã‚³ãƒ”ãƒšãƒ„ãƒ¼ãƒ«ï¼ˆè»½é‡ç‰ˆï¼‰</title>

  <style>
    :root{color-scheme:light dark;}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif;
      margin:12px;
      line-height:1.5;
    }
    h1{font-size:20px;margin:0 0 12px}
    .card{border:1px solid rgba(127,127,127,.35);border-radius:14px;padding:12px}
    label{display:block;font-size:12px;opacity:.85;margin:10px 0 6px}
    input,textarea,select{
      width:100%; box-sizing:border-box;
      border:1px solid rgba(127,127,127,.35);
      border-radius:12px;
      padding:10px 12px;
      background:transparent;
      color:inherit;
      font-size:16px;
    }
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1 1 160px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{
      border:1px solid rgba(127,127,127,.35);
      border-radius:14px;
      padding:10px 14px;
      background:transparent;
      color:inherit;
      font-size:16px;
      cursor:pointer;
    }
    button.primary{background:rgba(0,122,255,.18);border-color:rgba(0,122,255,.55)}
    pre{
      white-space:pre-wrap;
      border:1px dashed rgba(127,127,127,.45);
      border-radius:12px;
      padding:10px 12px;
      margin:12px 0 0;
      font-size:14px;
    }
    .tiny{font-size:12px;opacity:.75;margin-top:8px}

    /* ===== ğŸ¤ãƒœã‚¿ãƒ³ç”¨ ===== */
    .voice-wrap{ position:relative; }
    .voice-btn{
      position:absolute; right:10px; top:10px;
      border:1px solid rgba(127,127,127,.35);
      background:transparent; color:inherit;
      border-radius:10px; padding:6px 10px;
      font-size:14px; cursor:pointer;
      user-select:none;
    }
    .voice-btn[disabled]{ opacity:.4; cursor:not-allowed; }
    .voice-btn.recording{ outline:2px solid rgba(0,122,255,.7); }
  </style>
</head>

<body>
  <h1>FDARã‚³ãƒ”ãƒšãƒ„ãƒ¼ãƒ«ï¼ˆè»½é‡ç‰ˆï¼‰</h1>

  <div class="card">
    <div class="row">
      <div class="voice-wrap">
        <label for="name">åˆ©ç”¨è€…å</label>
        <input id="name" type="text" placeholder="ä¾‹ï¼šã€‡ã€‡ã€‡ã€‡ æ§˜" />
      </div>

      <div class="voice-wrap">
        <label for="date">æ—¥ä»˜</label>
        <input id="date" type="text" placeholder="ä¾‹ï¼š2026/02/07" />
      </div>
    </div>

    <div class="voice-wrap">
      <label for="f">Fï¼ˆè¨´ãˆãƒ»çŠ¶æ³ï¼‰</label>
      <textarea id="f" placeholder="ä¾‹ï¼šæœ¬æ—¥ã‚‚è…°ç—›ã‚ã‚Šã€‚æ­©è¡Œæ™‚ã«ç—›ã¿å¢—å¼·ã€‚"></textarea>
    </div>

    <div class="voice-wrap">
      <label for="d">Dï¼ˆè©•ä¾¡ãƒ»æ‰€è¦‹ï¼‰</label>
      <textarea id="d" placeholder="ä¾‹ï¼šç«‹ä½ã§ç–¼ç—›NRSâ—¯/10ã€‚ä½“å¹¹ä¼¸å±•ã§å¢—æ‚ªã€‚"></textarea>
    </div>

    <div class="voice-wrap">
      <label for="a">Aï¼ˆå¯¾å¿œãƒ»ä»‹å…¥ï¼‰</label>
      <textarea id="a" placeholder="ä¾‹ï¼šä½“å¹¹å®‰å®šåŒ–ç·´ç¿’ã€å‹•ä½œæŒ‡å°ã€ç–¼ç—›ç·©å’Œç›®çš„ã®å¾’æ‰‹ã€‚"></textarea>
    </div>

    <div class="voice-wrap">
      <label for="r">Rï¼ˆåå¿œãƒ»çµæœï¼‰</label>
      <textarea id="r" placeholder="ä¾‹ï¼šä»‹å…¥å¾Œã€ç«‹ä½æ™‚ç—›ã¿è»½æ¸›ã€‚æ­©è¡Œè·é›¢ãŒä¼¸ã³ãŸã€‚"></textarea>
    </div>

    <div class="btns">
      <button class="primary" id="make">ä½œæˆ</button>
      <button id="copy">ã‚³ãƒ”ãƒ¼</button>
      <button id="clear">ã‚¯ãƒªã‚¢</button>
    </div>

    <pre id="out"></pre>

    <div class="tiny">â€»ã€Œä½œæˆã€â†’ã€Œã‚³ãƒ”ãƒ¼ã€ã§ãã®ã¾ã¾è¨˜éŒ²ã«è²¼ã‚Œã¾ã™</div>
  </div>

  <script>
    // ===== ç”Ÿæˆï¼ˆFDARï¼‰ =====
    const $ = (id) => document.getElementById(id);

    function makeText(){
      const name = $("name").value.trim();
      const date = $("date").value.trim();
      const f = $("f").value.trim();
      const d = $("d").value.trim();
      const a = $("a").value.trim();
      const r = $("r").value.trim();

      const lines = [];
      if (name || date) {
        lines.push(`ã€åˆ©ç”¨è€…ã€‘${name || "â€”"}ã€€ã€æ—¥ä»˜ã€‘${date || "â€”"}`);
      }
      lines.push("");
      lines.push("Fï¼š");
      lines.push(f || "â€”");
      lines.push("");
      lines.push("Dï¼š");
      lines.push(d || "â€”");
      lines.push("");
      lines.push("Aï¼š");
      lines.push(a || "â€”");
      lines.push("");
      lines.push("Rï¼š");
      lines.push(r || "â€”");

      return lines.join("\n");
    }

    $("make").addEventListener("click", () => {
      $("out").textContent = makeText();
    });

    $("copy").addEventListener("click", async () => {
      const text = $("out").textContent.trim() ? $("out").textContent : makeText();
      $("out").textContent = text;

      try {
        await navigator.clipboard.writeText(text);
        alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚");
      } catch (e) {
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIãŒä¸å¯ã®ç’°å¢ƒå‘ã‘ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚");
      }
    });

    $("clear").addEventListener("click", () => {
      ["name","date","f","d","a","r"].forEach(id => $(id).value = "");
      $("out").textContent = "";
    });

    // ===== ğŸ¤ éŸ³å£°å…¥åŠ›ï¼ˆWeb Speech APIï¼‰ =====
    (() => {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const supported = !!SpeechRecognition;

      // å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆã“ã®HTMLã¯ id ãŒæƒã£ã¦ã„ã‚‹ã®ã§ãã®ã¾ã¾ï¼‰
      const targets = ["name","date","f","d","a","r"];

      // ğŸ¤ãƒœã‚¿ãƒ³ã‚’å„ voice-wrap ã«ä»˜ä¸
      targets.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const wrap = el.closest(".voice-wrap");
        if (!wrap) return;

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "voice-btn";
        btn.textContent = supported ? "ğŸ¤" : "ğŸ¤Ã—";
        btn.title = supported ? "éŸ³å£°å…¥åŠ›" : "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜æœªå¯¾å¿œ";
        btn.disabled = !supported;
        btn.dataset.targetId = id;
        wrap.appendChild(btn);
      });

      if (!supported) return;

      const rec = new SpeechRecognition();
      rec.lang = "ja-JP";
      rec.interimResults = true;
      rec.continuous = true;

      let currentEl = null;
      let currentBtn = null;
      let finalText = "";

      const stop = () => {
        try { rec.stop(); } catch(e) {}
        if (currentBtn) currentBtn.classList.remove("recording");
        currentEl = null;
        currentBtn = null;
        finalText = "";
      };

      rec.onresult = (e) => {
        if (!currentEl) return;

        let interim = "";
        for (let i = e.resultIndex; i < e.results.length; i++) {
          const txt = e.results[i][0].transcript;
          if (e.results[i].isFinal) finalText += txt;
          else interim += txt;
        }
        currentEl.value = (finalText || "") + (interim || "");
      };

      rec.onerror = () => {
        stop();
        alert("éŸ³å£°å…¥åŠ›ãŒé–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      };

      rec.onend = () => {
        if (currentBtn) currentBtn.classList.remove("recording");
        currentEl = null;
        currentBtn = null;
        finalText = "";
      };

      document.addEventListener("click", (ev) => {
        const btn = ev.target.closest(".voice-btn");
        if (!btn) return;

        const id = btn.dataset.targetId;
        const el = document.getElementById(id);
        if (!el) return;

        if (currentBtn && currentBtn !== btn) stop();

        if (btn.classList.contains("recording")) {
          stop();
          return;
        }

        currentEl = el;
        currentBtn = btn;
        finalText = (el.value || "") + ((el.value && !el.value.endsWith(" ")) ? " " : "");
        btn.classList.add("recording");

        try {
          rec.start();
        } catch (e) {
          try { rec.stop(); } catch(_) {}
          setTimeout(() => { try { rec.start(); } catch(_) {} }, 150);
        }
      });
    })();
  </script>
</body>
</html>
