<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FDARè¨˜éŒ²æ”¯æ´ãƒ„ãƒ¼ãƒ«</title>

  <style>
    :root { color-scheme: light dark; }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Sans", "Yu Gothic", sans-serif;
      margin: 12px;
      line-height: 1.5;
    }
    h1{ font-size: 20px; margin: 0 0 12px; }
    .card{
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 14px;
      padding: 12px;
      margin: 0 0 12px;
    }
    label{
      display:block;
      font-size: 12px;
      opacity: .85;
      margin: 10px 0 6px;
    }
    input, textarea{
      width: 100%;
      box-sizing: border-box;
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 12px;
      padding: 10px 12px;
      background: transparent;
      color: inherit;
      font-size: 16px;
      outline: none;
    }
    textarea{ min-height: 92px; resize: vertical; }
    .row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .row > div{ flex: 1 1 160px; min-width: 160px; }

    .field-with-btn{
      position: relative;
    }
    .iconbtn{
      position:absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 999px;
      padding: 6px 10px;
      background: rgba(127,127,127,.08);
      color: inherit;
      font-size: 14px;
      line-height: 1;
    }
    textarea + .iconbtn{
      top: 12px;
      transform: none;
    }
    .iconbtn:active{ transform: translateY(-50%) scale(0.98); }
    textarea + .iconbtn:active{ transform: scale(0.98); }

    .btns{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    button{
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 16px;
      background: rgba(127,127,127,.10);
      color: inherit;
    }
    button.primary{
      background: #0b66ff;
      border-color: #0b66ff;
      color: white;
    }
    pre{
      margin: 10px 0 0;
      padding: 12px;
      border-radius: 14px;
      border: 1px dashed rgba(127,127,127,.45);
      white-space: pre-wrap;
      word-break: break-word;
      min-height: 64px;
    }
    .help{
      font-size: 12px;
      opacity: .8;
      margin-top: 8px;
    }
    .warn{
      font-size: 12px;
      opacity: .85;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <h1>FDARè¨˜éŒ²æ”¯æ´ãƒ„ãƒ¼ãƒ«</h1>

  <div class="card">
    <div class="row">
      <div>
        <label for="name">åˆ©ç”¨è€…å</label>
        <div class="field-with-btn">
          <input id="name" type="text" placeholder="ä¾‹ï¼šã€‡ã€‡ã€‡ã€‡ æ§˜" autocomplete="off" />
          <button class="iconbtn" type="button" data-act="mic" data-target="name" aria-label="åˆ©ç”¨è€…åã‚’éŸ³å£°å…¥åŠ›">ğŸ¤</button>
        </div>
      </div>
      <div>
        <label for="date">æ—¥ä»˜</label>
        <div class="field-with-btn">
          <input id="date" type="text" placeholder="ä¾‹ï¼š2026/02/07" autocomplete="off" />
          <button class="iconbtn" type="button" data-act="mic" data-target="date" aria-label="æ—¥ä»˜ã‚’éŸ³å£°å…¥åŠ›">ğŸ¤</button>
        </div>
      </div>
    </div>

    <label for="f">Fï¼ˆè¨´ãˆãƒ»çŠ¶æ³ï¼‰</label>
    <div class="field-with-btn">
      <textarea id="f" placeholder="ä¾‹ï¼šæœ¬æ—¥ã‚‚è…°ç—›ã‚ã‚Šã€‚æ­©è¡Œæ™‚ã«ç—›ã¿å¢—å¼·ã€‚"></textarea>
      <button class="iconbtn" type="button" data-act="mic" data-target="f" aria-label="Fã‚’éŸ³å£°å…¥åŠ›">ğŸ¤</button>
    </div>

    <label for="d">Dï¼ˆè©•ä¾¡ãƒ»æ‰€è¦‹ï¼‰</label>
    <div class="field-with-btn">
      <textarea id="d" placeholder="ä¾‹ï¼šç«‹ä½ã§ç–¼ç—›NRSâ—‹/10ã€‚ä½“å¹¹ä¼¸å±•ã§å¢—æ‚ªã€‚"></textarea>
      <button class="iconbtn" type="button" data-act="mic" data-target="d" aria-label="Dã‚’éŸ³å£°å…¥åŠ›">ğŸ¤</button>
    </div>

    <label for="a">Aï¼ˆå¯¾å¿œãƒ»ä»‹å…¥ï¼‰</label>
    <div class="field-with-btn">
      <textarea id="a" placeholder="ä¾‹ï¼šä½“å¹¹å®‰å®šåŒ–ç·´ç¿’ã€å‹•ä½œæŒ‡å°ã€ç–¼ç—›ç·©å’Œç›®çš„ã®å¾’æ‰‹ã€‚"></textarea>
      <button class="iconbtn" type="button" data-act="mic" data-target="a" aria-label="Aã‚’éŸ³å£°å…¥åŠ›">ğŸ¤</button>
    </div>

    <label for="r">Rï¼ˆåå¿œãƒ»çµæœï¼‰</label>
    <div class="field-with-btn">
      <textarea id="r" placeholder="ä¾‹ï¼šä»‹å…¥å¾Œã€ç«‹ä½æ™‚ç—›ã¿è»½æ¸›ã€‚æ­©è¡Œè·é›¢ãŒä¼¸ã³ãŸã€‚"></textarea>
      <button class="iconbtn" type="button" data-act="mic" data-target="r" aria-label="Rã‚’éŸ³å£°å…¥åŠ›">ğŸ¤</button>
    </div>

    <div class="btns">
      <button class="primary" type="button" id="btnMake">ä½œæˆ</button>
      <button type="button" id="btnCopy">ã‚³ãƒ”ãƒ¼</button>
      <button type="button" id="btnClear">ã‚¯ãƒªã‚¢</button>
    </div>

    <pre id="out" aria-label="ç”Ÿæˆçµæœ"></pre>

    <div class="help">â€»ã€Œä½œæˆã€â†’ã€Œã‚³ãƒ”ãƒ¼ã€ã§ãã®ã¾ã¾è¨˜éŒ²ã«è²¼ã‚Œã¾ã™</div>
    <div class="warn" id="speechNote"></div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  function buildText() {
    const name = $("name").value.trim();
    const date = $("date").value.trim();
    const f = $("f").value.trim();
    const d = $("d").value.trim();
    const a = $("a").value.trim();
    const r = $("r").value.trim();

    const lines = [];
    if (name) lines.push(`ã€åˆ©ç”¨è€…ã€‘${name}`);
    if (date) lines.push(`ã€æ—¥ä»˜ã€‘${date}`);
    if (name || date) lines.push("");

    if (f) lines.push(`Fï¼š${f}`);
    if (d) lines.push(`Dï¼š${d}`);
    if (a) lines.push(`Aï¼š${a}`);
    if (r) lines.push(`Rï¼š${r}`);

    return lines.join("\n");
  }

  $("btnMake").addEventListener("click", () => {
    $("out").textContent = buildText();
  });

  $("btnCopy").addEventListener("click", async () => {
    const text = $("out").textContent || buildText();
    if (!text.trim()) return;

    try {
      await navigator.clipboard.writeText(text);
      // ä½•ã‚‚å‡ºã•ãªã„ï¼ˆã‚·ãƒ³ãƒ—ãƒ«é‹ç”¨ï¼‰
    } catch (e) {
      // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ä¸å¯ã®ç’°å¢ƒå‘ã‘ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }
  });

  $("btnClear").addEventListener("click", () => {
    ["name","date","f","d","a","r"].forEach(id => $(id).value = "");
    $("out").textContent = "";
  });

  // --- éŸ³å£°å…¥åŠ›ï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰---
  // iOS Safari ã¯ Web Speech API ãŒç„¡åŠ¹ãªã“ã¨ãŒã‚ã‚‹ãŸã‚ã€ä½¿ãˆãªã„å ´åˆã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒã‚¤ã‚¯ï¼ˆéŸ³å£°å…¥åŠ›ï¼‰ã‚’æ¡ˆå†…
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  let rec = null;
  let busy = false;

  function setSpeechNote(msg) {
    $("speechNote").textContent = msg || "";
  }

  if (SpeechRecognition) {
    rec = new SpeechRecognition();
    rec.lang = "ja-JP";
    rec.interimResults = false;
    rec.maxAlternatives = 1;

    rec.onstart = () => { busy = true; };
    rec.onend = () => { busy = false; };
    rec.onerror = () => {
      busy = false;
      setSpeechNote("éŸ³å£°å…¥åŠ›ãŒé–‹å§‹ã§ããªã„å ´åˆã¯ã€iPhoneã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒã‚¤ã‚¯ï¼ˆéŸ³å£°å…¥åŠ›ï¼‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚");
    };
  } else {
    setSpeechNote("ã“ã®ç’°å¢ƒã§ã¯ãƒšãƒ¼ã‚¸å†…ã®éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ãŒä½¿ãˆãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚iPhoneã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒã‚¤ã‚¯ï¼ˆéŸ³å£°å…¥åŠ›ï¼‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚");
  }

  function startDictation(targetId) {
    if (!rec) return;
    if (busy) return;

    setSpeechNote("");
    rec.onresult = (ev) => {
      const t = (ev.results?.[0]?.[0]?.transcript || "").trim();
      if (!t) return;
      const el = $(targetId);
      // è¿½è¨˜ï¼ˆæ—¢ã«æ–‡å­—ãŒã‚ã‚‹å ´åˆã¯æ”¹è¡Œ or ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
      const sep = el.tagName === "TEXTAREA" ? (el.value ? "\n" : "") : (el.value ? " " : "");
      el.value = el.value + sep + t;
    };
    try {
      rec.start();
    } catch (e) {
      setSpeechNote("éŸ³å£°å…¥åŠ›ãŒé–‹å§‹ã§ããªã„å ´åˆã¯ã€iPhoneã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒã‚¤ã‚¯ï¼ˆéŸ³å£°å…¥åŠ›ï¼‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚");
    }
  }

  document.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-act]");
    if (!btn) return;
    const act = btn.getAttribute("data-act");
    const target = btn.getAttribute("data-target");
    if (act === "mic") startDictation(target);
  });
</script>
</body>
</html>
